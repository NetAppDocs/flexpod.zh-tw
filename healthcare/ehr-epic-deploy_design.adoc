---
sidebar: sidebar 
permalink: healthcare/ehr-epic-deploy_design.html 
keywords: design, flexpod, epic, cisco, architecture, storage, layout, volume, lun, configuration 
summary: Epic的架構FlexPod 是以Epic、Cisco和NetApp的指引為基礎、也以合作夥伴與各種規模Epic客戶合作的經驗為基礎。此架構可靈活調整、並根據客戶的資料中心策略、無論規模大小、以及是集中式、分散式或多租戶、套用Epic的最佳實務做法。 
---
= 設計
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


Epic的架構FlexPod 是以Epic、Cisco和NetApp的指引為基礎、也以合作夥伴與各種規模Epic客戶合作的經驗為基礎。此架構可靈活調整、並根據客戶的資料中心策略、無論規模大小、以及是集中式、分散式或多租戶、套用Epic的最佳實務做法。

正確的儲存架構可由整體大小和IOPS總計來決定。效能不只是唯一的考量因素、您可能會決定根據其他客戶需求、使用較大的節點數。使用NetApp的優勢在於、叢集可隨著需求變化而輕鬆地在不中斷營運的情況下擴充。您也可以在不中斷營運的情況下、從叢集中移除節點以重新規劃用途、或在設備重新整理期間移除節點。

以下是NetApp ONTAP 解決方案儲存架構的一些優點：

* *簡易且不中斷營運的垂直擴充和橫向擴充。*使用ONTAP 不中斷營運的功能、即可升級、新增或移除磁碟和節點。客戶可以從四個節點開始、移至六個節點、或在不中斷營運的情況下升級至較大的控制器。
* *儲存效率。*利用重複資料刪除技術、FlexClone、即時壓縮、即時壓縮、精簡複寫、 資源隨需配置、以及集合式重複資料刪除技術。FlexClone功能可讓您幾乎立即建立複本、以支援備份與測試環境更新。這些複本只會在進行變更時使用額外的儲存設備。
* *能夠備份及更新Epic完整複製測試環境的功能。*此解決方案以整合式效率簡化架構並節省儲存容量。OnCommand這些架構是Epic備份解決方案的重要考量因素、並運用儲存整合功能與任何備份解決方案整合。
* *災難恢復陰影資料庫伺服器。*災難恢復陰影資料庫伺服器是客戶營運不中斷策略的一部分（用於支援儲存唯讀[SRO]功能、並可能設定為儲存讀寫[SRW]執行個體）。因此、在大多數情況下、第三個儲存系統的放置和規模、與正式作業資料庫儲存系統相同。
* *資料庫一致性（需要考量）。*如果使用SnapMirror備份複本來維持營運不中斷、請參閱文件《Epic Business Continuity技術解決方案指南》。」如需使用SnapMirror技術的相關資訊、請參閱 http://media.netapp.com/documents/tr-3446.pdf["TR-3446：SnapMirror非同步概述與最佳實務做法指南"^]。
* *將正式作業與潛在的高效能工作負載隔離、是Epic的主要設計目標。*儲存資源池是故障網域、必須隔離並保護工作負載效能。在一個故障叢集中的每個節點ONTAP 都是一個故障網域、可視為一個儲存資源池。


所有的平台均可執行Epic工作負載的完整功能集。ONTAP



== 儲存架構

下圖說明6節點架構、這是Epic環境中常用的架構。也有4節點或12節點的部署、但這些架構只是設計的參考或起點。工作負載必須在中驗證 https://spm.netapp.com["SPM"^] 磁碟數量與控制器使用率的規模調整工具。所有Epic正式作業都部署在AFF 不完整的陣列上。請參閱Epic All Flash參考架構策略手冊、瞭解Epic儲存配置需求。


NOTE: 與NetApp Epic團隊合作驗證所有設計。Epic需要使用NetApp規模調整方法來適當調整NetApp儲存系統的規模、以便在Epic環境中使用。如需詳細資訊、請參閱 https://fieldportal.netapp.com/content/192412["TR-3930i：《NetApp Epic規模調整準則》（NetApp Sizing Guidelines for Epic）"^]。若要檢視本文件、必須存取NetApp Field Portal。

六節點架構包含四個用於正式作業的節點、以及兩個用於DR的節點。Epic All Flash參考架構策略手冊採用這種架構、搭配四節點正式作業、說明您可以將Epic Report工作負載與Clarity區隔開來。

使用六個節點具有下列主要優勢：

* 您可以從正式作業卸載備份歸檔程序
* 您可以從正式作業卸載所有測試環境


正式作業執行於節點prod-01。報告會在節點prod-02上執行、這是正式作業最新的Epic鏡射複本。例如支援、版本及版本驗證（SUP、REL及RELVAL）等測試環境、可從Epic正式作業、報告或DR即時複製。下圖顯示從正式作業環境製作的完整複本測試環境複本。

第二個HA配對用於正式作業服務儲存需求。這些工作負載包括Clarity資料庫伺服器（SQL或Oracle）、VMware、Hyperspace和CIFS的儲存設備。客戶可能擁有非Epic工作負載、可在此架構中新增至節點3和4、或最好新增至同一個叢集中的個別HA配對。

SnapMirror技術用於將正式作業資料庫的儲存層級複寫至第二個HA。SnapMirror備份複本可用於在第二個儲存系統上建立FlexClone磁碟區、以供非正式作業環境使用、例如支援、發行和版本驗證。正式作業資料庫的儲存層級複本也可支援客戶實作其災難恢復策略。

或者、若要提高儲存效率、可從報告Snapshot複本備份建立完整測試複本、並直接在節點2上執行。使用此設計、不需要將SnapMirror目的地複本儲存在磁碟上。

image:ehr-epic-deploy_image7.png["錯誤：缺少圖形影像"]



== 儲存設計與配置

滿足Epic的HA和備援需求的第一步、是專為Epic軟體環境設計儲存配置、包括將磁碟集區1從磁碟集區2隔離至專屬的高效能儲存設備。請參閱Epic All Flash參考架構策略手冊、瞭解每個磁碟集區中的工作負載。

將每個磁碟集區放在獨立的節點上、會建立Epic隔離正式作業和非正式作業工作負載所需的故障網域。每個節點使用一個Aggregate、可將磁碟使用率和Aggregate關聯性最大化、以提供更好的效能。此設計也能利用Aggregate層級的重複資料刪除技術、將儲存效率最大化。

由於Epic可讓儲存資源共享以滿足非正式作業需求、因此儲存系統通常可同時滿足Clarity伺服器和正式作業服務的儲存需求、例如VDI、CIFS及其他企業功能。

下圖顯示6節點架構的儲存配置。每個儲存系統都是完整備援HA配對中的單一節點。此配置可確保每個控制器的最大使用率和儲存效率。

image:ehr-epic-deploy_image8.png["錯誤：缺少圖形影像"]



=== 儲存節點組態

*高可用度*

在HA配對中設定節點的儲存系統、可減輕節點故障的影響、並可在不中斷營運的情況下升級儲存系統。連接至具有多個路徑之節點的磁碟櫃可防止單一路徑故障、同時在節點容錯移轉期間提供更佳的效能一致性、進而提升儲存恢復能力。

*硬體輔助容錯移轉*

硬體輔助的容錯移轉可將儲存節點的容錯移轉時間減至最短、方法是啟用一個節點的遠端LAN模組或服務處理器模組、以比活動訊號逾時觸發更快的速度通知其合作夥伴、縮短容錯移轉之前所需的時間。當儲存設備虛擬化時、容錯移轉時間會縮短、因為控制器身分識別不需要在容錯移轉期間移動。只有軟體磁碟擁有權變更。

* NetApp支援工具與服務*

NetApp提供完整的支援工具與服務。如果AutoSupport 發生硬體故障或系統組態錯誤、應在NetApp儲存系統上啟用並設定NetApp支援工具、以便撥打住家電話。對於任務關鍵型環境、NetApp也建議SupportEdge Premium 使用此功能的支援套件、以便取得營運專家、延長支援時間、以及快速更換零件的回應時間。

* AFF 《All Flash最佳化特性》（All Flash最佳化特性）、適用於S4A300和AFF S4A700控制器*

為了讓解決方案正常運作、在HA配對的All Flash最佳化FAS80x0系統中、兩個節點上的環境變數「bootarg.init.flash_optimized`」必須設為「true」AFF 。具備All Flash最佳化特性的平台僅支援SSD。



=== Volume組態

* Snapshot複本*

應針對提供正式作業資料庫儲存設備的磁碟區、設定夜間磁碟區層級的Snapshot排程。Volume層級的Snapshot複本也可做為複製正式作業資料庫的來源、以用於非正式作業環境、例如開發、測試和接移。NetApp已針對OnCommand Epic開發出一套適用於Epic的WFA工作流程、可將正式作業資料庫的備份作業自動化、並可重新整理測試環境。這些工作流程會凍結資料庫、並將其解出、以利應用程式一致的Snapshot複本。正式作業的備份複本會自動呈現給測試伺服器、以供支援、發行及版本驗證之用。這些工作流程也可用於備份串流和完整性檢查。

Snapshot複本可用於支援Epic正式作業資料庫的還原作業。

您可以使用SnapMirror在獨立於正式作業的儲存系統上維護Snapshot複本。

對於SAN磁碟區、請停用每個磁碟區的預設Snapshot原則。這些Snapshot複本通常由備份應用程式或OnCommand 由WFA工作流程來管理。NetApp建議開啟所有效率設定、以最大化磁碟使用率。

* Volume關聯性*

為了支援並行處理、ONTAP 在啟動時、它會評估可用的硬體、並將其集合體和磁碟區分成不同的類別、稱為「關聯」。一般而言、屬於同一關聯的磁碟區可與位於其他關聯中的磁碟區並行提供服務。相反地、兩個具有相同關聯性的磁碟區通常必須輪候節點CPU上的排程時間（序列處理）。

此功能可讓AFF 您在AFF 每個節點上使用單一的Aggregate關聯性和四個Volume關聯性。為達到最佳節點使用率和使用Volume相似性、每個節點的儲存配置應為一個Aggregate、每個節點至少應為四個Volume。一般而言、Epic資料庫使用八個磁碟區或LUN。



=== LUN組態

文件「Epic資料庫儲存配置建議」詳細說明每個資料庫的LUN大小和數量。客戶必須檢視Epic支援、並最終確定LUN數量和LUN大小；可能需要稍微調整。

建議從較大大小的LUN開始、因為LUN本身的大小並不需要支付任何儲存成本。為了便於操作、請確定LUN數量和初始大小在三年後可大增至超出預期需求。擴充時、LUN的擴充比新增LUN更容易管理。在LUN和磁碟區上進行精簡配置時、只有使用的儲存設備會顯示在集合體中。

Epic正式作業和Clarity使用每個Volume一個LUN。對於較大型的部署、NetApp建議Epic資料庫使用24到32個LUN。

決定要使用的LUN數量的因素包括：

* 三年後Epic DB的整體規模。對於較大的DB、請判斷該作業系統的LUN大小上限、並確定您有足夠的LUN可擴充。例如、如果您需要60TB Epic資料庫、而作業系統LUN的容量上限為4TB、則需要24到32個LUN來提供擴充和保留空間。



NOTE: Epic需要透過FC將資料庫、日誌、應用程式或系統儲存設備、以LUN的形式呈現給資料庫伺服器。
